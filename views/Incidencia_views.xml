<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ===================== -->
    <!-- VISTA SEARCH -->
    <!-- ===================== -->
    <record id="view_incidencia_search" model="ir.ui.view">
    <field name="name">incidencias.incidencia.search</field>
    <field name="model">incidencias.incidencia</field>
    <field name="arch" type="xml">
        <search string="Buscar Incidencias">

            <field name="titulo"/>
            <field name="departamento_id"/>
            <field name="empleado_origen_id"/>

            <!-- Estados -->
            <filter name="f_abiertas"
                    string="Abiertas"
                    domain="[('estado_actual','=','abierta')]"/>

            <filter name="f_en_progreso"
                    string="En Progreso"
                    domain="[('estado_actual','=','en_progreso')]"/>

            <filter name="f_resueltas"
                    string="Resueltas"
                    domain="[('estado_actual','=','resuelta')]"/>

            <filter name="f_cerradas"
                    string="Cerradas"
                    domain="[('estado_actual','=','cerrada')]"/>

            <!-- Comentarios -->
            <filter name="f_sin_comentarios"
                    string="Sin Comentarios"
                    domain="[('total_comentarios','=',0)]"/>

            <filter name="f_con_comentarios"
                    string="Con Comentarios"
                    domain="[('total_comentarios','>',0)]"/>

            <!-- Agrupaciones -->
            <group expand="0" string="Agrupar por">
                <filter name="g_departamento"
                        string="Departamento"
                        context="{'group_by':'departamento_id'}"/>

                <filter name="g_estado"
                        string="Estado"
                        context="{'group_by':'estado_actual'}"/>
            </group>

        </search>
    </field>
</record>


    <!-- ===================== -->
    <!-- VISTA KANBAN -->
    <!-- ===================== -->
    <record id="view_incidencia_kanban" model="ir.ui.view">
    <field name="name">incidencias.incidencia.kanban</field>
    <field name="model">incidencias.incidencia</field>
    <field name="arch" type="xml">
        <kanban default_group_by="estado_actual" class="o_kanban_small_column">
            <field name="titulo"/>
            <field name="estado_actual"/>
            <field name="departamento_id"/>
            <field name="empleado_origen_id"/>
            <field name="total_comentarios"/>
            <field name="fecha_creacion"/>

            <templates>
                <t t-name="kanban-box">
                    <div class="oe_kanban_global_click o_kanban_card">

                        <!-- CABECERA -->
                        <div class="o_kanban_card_header">
                            <strong class="o_kanban_record_title">
                                <field name="titulo"/>
                            </strong>
                            <field name="estado_actual"
                                   widget="badge"
                                   class="float-end"/>
                        </div>

                        <!-- CUERPO -->
                        <div class="o_kanban_card_body mt8">
                            <div>
                                <i class="fa fa-building me-1"/>
                                <field name="departamento_id"/>
                            </div>

                            <div>
                                <i class="fa fa-user me-1"/>
                                <field name="empleado_origen_id"/>
                            </div>

                            <div attrs="{'invisible':[('total_comentarios','=',0)]}">
                                <i class="fa fa-comments me-1"/>
                                <field name="total_comentarios"/> comentarios
                            </div>
                        </div>

                        <!-- FOOTER -->
                        <div class="o_kanban_card_footer mt8">
                            <small class="text-muted">
                                <i class="fa fa-calendar me-1"/>
                                <field name="fecha_creacion" widget="date"/>
                            </small>
                        </div>

                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>



    <!-- ===================== -->
    <!-- VISTA TREE -->
    <!-- ===================== -->
    <record id="view_incidencia_tree" model="ir.ui.view">
        <field name="name">incidencias.incidencia.tree</field>
        <field name="model">incidencias.incidencia</field>
        <field name="arch" type="xml">
            <tree string="Incidencias"
                  decoration-info="estado_actual == 'abierta'"
                  decoration-warning="estado_actual == 'en_progreso'"
                  decoration-success="estado_actual == 'resuelta'"
                  decoration-danger="estado_actual == 'cerrada'">
                <field name="titulo"/>
                <field name="departamento_id"/>
                <field name="empleado_origen_id"/>
                <field name="fecha_creacion"/>
                <field name="estado_actual" widget="badge"/>
                <field name="total_comentarios"/>
                <field name="ultimo_comentario"/>
            </tree>
        </field>
    </record>

    <!-- ===================== -->
    <!-- VISTA FORM -->
    <!-- ===================== -->
    <record id="view_incidencia_form" model="ir.ui.view">
        <field name="name">incidencias.incidencia.form</field>
        <field name="model">incidencias.incidencia</field>
        <field name="arch" type="xml">
            <form string="Incidencia">
                <header>
                    <field name="estado_actual"
                           widget="statusbar"
                           statusbar_visible="abierta,en_progreso,resuelta,cerrada"/>

                    <button name="set_en_progreso"
                            type="object"
                            string="Iniciar Progreso"
                            class="btn-primary"
                            attrs="{'invisible':[('estado_actual','!=','abierta')]}"/>

                    <button name="set_resuelta"
                            type="object"
                            string="Marcar Resuelta"
                            class="btn-success"
                            attrs="{'invisible':[('estado_actual','!=','en_progreso')]}"/>

                    <button name="set_cerrada"
                            type="object"
                            string="Cerrar"
                            class="btn-warning"
                            attrs="{'invisible':[('estado_actual','!=','resuelta')]}"/>

                    <button name="reabrir"
                            type="object"
                            string="Reabrir"
                            class="btn-secondary"
                            attrs="{'invisible':[('estado_actual','not in',['resuelta','cerrada'])]}"/>
                </header>

                <sheet>

                    <!-- ====== T√çTULO DE ESTADO (IGUAL QUE TUYO, SIN t-if) ====== -->
                    <div class="oe_title"
                         style="text-align:center; margin:20px 0; padding:10px;
                                background-color:#f8f9fa; border-radius:5px;">

                        <div attrs="{'invisible':[('estado_actual','!=','en_progreso')]}"
                             style="font-size:24px; font-weight:bold; color:#0d6efd;">
                            ‚öôÔ∏è EN PROGRESO
                        </div>

                        <div attrs="{'invisible':[('estado_actual','!=','resuelta')]}"
                             style="font-size:24px; font-weight:bold; color:#198754;">
                            ‚úì RESUELTA
                        </div>

                        <div attrs="{'invisible':[('estado_actual','!=','cerrada')]}"
                             style="font-size:24px; font-weight:bold; color:#6c757d;">
                            ‚úó CERRADA
                        </div>

                        <div attrs="{'invisible':[('estado_actual','!=','abierta')]}"
                             style="font-size:24px; font-weight:bold; color:#dc3545;">
                            üîì ABIERTA
                        </div>
                    </div>

                    <!-- ====== DATOS ====== -->
                    <group>
                        <group string="Informaci√≥n Principal">
                            <field name="titulo"/>
                            <field name="departamento_id"/>
                            <field name="empleado_origen_id"/>
                            <field name = "proyecto"/>
                        </group>

                        <group string="Seguimiento">
                            <field name="fecha_creacion" readonly="1"/>
                            <field name="total_comentarios" readonly="1"/>
                            <field name="ultimo_comentario" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Descripci√≥n">
                            <field name="descripcion" nolabel="1"/>
                        </page>

                        <page string="Comentarios">
                            <field name="comentario_ids"/>
                        </page>

                        <page string="Actividad">
                            <field name="message_ids" widget="mail_thread"/>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

</odoo>
